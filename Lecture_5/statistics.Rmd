---
title: "Lecture 5"
author: "Misja Mikkers and Gertjan Verhoeven"
subtitle: Simulation-based Statistics
output:
  html_document:
    df_print: paged
---

# Packages

For this notebook we need the tidyverse package (which should already be installed).

```{r}
library(tidyverse)
```


# Statistical Testing vs simulation

R has its origins as **statistical** programming language. 
So let's do statistics.
A lot of people associate doing statistics with performing **statistical tests**.
There are various problems associated with this approach to statistics.

As computers have become faster, and software better, a different way of doing statistics has become possible.
An important part is about **simulation** of data.
This means generating "fake" data according to our model / assumptions, doing this many times, and analyzing the outcomes.

This notebook provides an introduction to this new way of doing statistics.

# Probability

Very often when we analyse data, there is an element of chance involved.
This element of chance introduces uncertainty when we want to draw conclusions.

For example, suppose we ask twenty students in the hallway of the Tilburg University building their height and their sex.
And suppose we obtain the following set of numbers:

```{r}
df <- read.csv2("sourcedata/survey.csv")

df
```
We are curious whether there is a structural difference in heights when we compare female with male students.

Let us first analyse the data with the methods we have learned so far.

# Exercise 1

Make a histogram of all heights in the dataset, regardless of sex.
Then make a histogram using `facet_wrap()` for each sex separately.
Finally, calculate the mean height by sex group.

```{r}
# your code here
ggplot() +
  geom_histogram(data = df, aes(height))

ggplot() +
  geom_histogram(data = df, aes(x = height)) +
  facet_wrap(~sex)

mean_heights <- df %>%
  group_by(sex) %>%
  summarise(mean = mean(height))
```



So we find a difference. But can we now conclude that female students are on average taller than male students (in the hallway of our university building)? 

To do so, we need a statistical model.

According to Wikipedia, a statistical model is:

> ... a mathematical model that embodies a set of statistical assumptions concerning the generation of sample data (and similar data from a larger population). A statistical model represents, often in considerably idealized form, the data-generating process.

For our idealized, mathematical model, we use the so-called "Normal distribution".

# The Normal distribution

Looking at the height data it appears that the values are spread out around a central location.
It also appears that values below 160 cm and above 200 cm are not observed.
I.e. there are no really extreme values such as 10 cm or 10 m.

For data with these characteristics, it is useful to **assume** that the data are generated by the Normal distribution.
The distribution is conveniently described by just two parameters, 

* the **central location** and 
* the amount of **spread** around the central location.

The central location is equal to the mean, this we all already familiar with.

The amount of spread of a set of numbers can be calculated by the **standard deviation** or **SD** for short.
In R, the function `sd()` is used for this. You will learn more about this in your statistics class.

# Exercise 2

First lets calculate the center location (mean) and the amount of spread in the heights.
Use the `sd()` function.

```{r}
# your code here

df %>%
  group_by(sex) %>%
  summarise(mean = mean(height), sd = sd(height))

df %>% 
  summarise(mean = mean(height), sd = sd(height))

```



In R we can simulate data from a Normal distribution using the function `rnorm()`.
Let us simulate a huge dataset of "fake" height values.
To ensure we obtain the same set of random numbers each time we run the code, we use the `set.seed()`function.
This line of code is already provided.

# Exercise 3

Find out what the arguments are for the `rnorm()` function.
Then use this to generate 10000 numbers from a Normal distribution with mean 181 and SD 10.
Finally, plot a histogram of these 10.000 numbers. Play around with the number of bins or with the binwidth parameter.

```{r}
set.seed(123)
rand_norm <- rnorm(10000, 181, 10)


ggplot() +
  geom_histogram(aes(x = rand_norm), bins = 70)
# your code here


```



# A simple model for heights

Great! Now we now how to simulate data according to assumptions we make of the world, or equivalently, assumptions on **how the data was generated**.

A good way to approach model building, is to start simple, and only add more complexity if the model does not describe the data well.

So let's make a simple model of heights and compare simulated data from the model with the actual observed data.

The simplest model is to assume that there are no structural differences in height between female and male students.

We already know that our height data has characteristics (central location with symmetric spread, no extreme values) that match those of the Normal distribution.

# Exercise 4

Simulate 10 datapoints from a normal distribution with mean and SD equal to our observed heights.
Calculate the mean for these 10 datapoints.

```{r}
set.seed(123)
mean(rnorm(10, 181, 10))
# your code here
```


# Exercise 5

Now write a **for loop** that execute the code you wrote in the previous exercise a 10000 times.
Store all the values of `mean(sample_heights)` in a vector `mean_vals`. You can use the pseudo code below as a starting point.

In this way we end up with 10000 means, all from different data, but from the same underlying model.
Plot a histogram with these 10000 means. 

```{r}
# your code here
mean_vals <- c()

for (i in 1:10000){
  mean_vals[i] <- mean(rnorm(10, 180, 10))
}

ggplot() +
  geom_histogram(aes(x = mean_vals))
```



# Confronting the model with our observed data

Because we can simulate data as often as we want, we learn what are **plausible** values for the average height, the quantity we are interested in.
From the exercise above, we learn that, when we only have 10 observations, values between 174 and 190 for the average height are all plausible outcomes.

# Exercise 6

Go back to the group averages by sex you calculated in Exercise 1.
Plot these group averages as red vertical lines in the plot you created in Exercise 5.
use `geom_vline()` for this.


```{r}
# your code here
ggplot() +
  geom_histogram(aes(x = mean_vals)) +
  geom_vline(xintercept = mean_heights$mean, color = "red")

```


Do these group averages for the separate sex groups provide compelling evidence that female students are taller than male students?
Or do they fall within the expected range of plausible values for a world where there are no height differences between the sexes at all?

End of Notebook
